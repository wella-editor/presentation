<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°œí‘œ ì¡°íšŒ ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --green-bg: #28a745;
            --blue-bg: #007bff;
            --gray-bg: #f8f9fa;
            --border-color: #dee2e6;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* --- 1. ë©”ì¸ í™”ë©´ ìŠ¤íƒ€ì¼ (ì´ë¯¸ì§€ 1 ì°¸ê³ ) --- */
        #main-screen {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .split-btn {
            flex: 1;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            text-decoration: none;
        }

        .split-btn-content {
            z-index: 2;
            text-align: center;
            color: white;
        }

        .split-btn h1 {
            font-size: 3rem;
            margin: 0;
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .split-btn i {
            font-size: 8rem;
            position: absolute;
            opacity: 0.2;
            transform: rotate(-15deg);
        }

        .btn-left {
            background-color: var(--green-bg);
        }
        .btn-left i { right: 20%; bottom: 10%; } /* ì±… ì•„ì´ì½˜ ìœ„ì¹˜ */

        .btn-right {
            background-color: var(--blue-bg);
        }
        .btn-right i { right: 20%; bottom: 10%; } /* íœ ì•„ì´ì½˜ ìœ„ì¹˜ */

        .split-btn:hover { filter: brightness(1.1); }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            #main-screen { flex-direction: column; }
            .split-btn h1 { font-size: 2rem; }
            .split-btn i { font-size: 5rem; }
        }

        /* --- 2. ê³µí†µ ì»¨í…Œì´ë„ˆ ë° íŒì—… ìŠ¤íƒ€ì¼ --- */
        .container {
            display: none;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }
        .active { display: block; }

        .header-title {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 30px 0;
            position: relative;
        }
        .header-title::after { /* ë°‘ì¤„ íš¨ê³¼ */
            content: '';
            display: block;
            width: 50px;
            height: 3px;
            background: #333;
            margin: 10px auto;
        }

        /* --- 3. ë¦¬ìŠ¤íŠ¸ í™”ë©´ ìŠ¤íƒ€ì¼ (ì´ë¯¸ì§€ 2 ì°¸ê³ ) --- */
        .search-bar {
            background: #fff;
            border: 1px solid var(--border-color);
            padding: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }

        .search-bar select, .search-bar input {
            padding: 8px;
            border: 1px solid #ccc;
            height: 40px;
            box-sizing: border-box;
        }

        .btn-search {
            background: #333;
            color: white;
            border: none;
            padding: 0 20px;
            height: 40px;
            cursor: pointer;
        }

        .list-table {
            width: 100%;
            border-collapse: collapse;
            border-top: 2px solid #007bff;
        }

        .list-table th {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            color: #333;
            font-weight: bold;
        }

        .list-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
            color: #666;
        }

        .list-table tr:hover { background-color: #f1f3f5; cursor: pointer; }
        
        .empty-row { padding: 50px; color: #999; }

        /* --- 4. ë¹„ë°€ë²ˆí˜¸ ë° ê´€ë¦¬ì ìŠ¤íƒ€ì¼ --- */
        .pin-wrapper {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: white; z-index: 1000;
            display: none; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .pin-inputs { display: flex; gap: 10px; margin: 20px; }
        .pin-inputs input {
            width: 50px; height: 60px; font-size: 30px; text-align: center;
            border: 2px solid #ddd; border-radius: 10px;
        }
        
        .admin-form label { display: block; margin-top: 15px; font-weight: bold; }
        .admin-form input, .admin-form textarea { width: 100%; padding: 10px; margin-top: 5px; box-sizing: border-box; }
        .btn-action {
            margin-top: 20px; padding: 10px 20px; border: none; border-radius: 5px;
            background: var(--blue-bg); color: white; cursor: pointer; font-size: 1rem;
        }
        .btn-secondary { background: #6c757d; }
        .btn-danger { background: #dc3545; }

        /* --- 5. ì¡°íšŒ ìƒì„¸ í™”ë©´ --- */
        .detail-card {
            border: 1px solid #ddd; padding: 30px; border-radius: 10px;
            max-width: 500px; margin: 0 auto; background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .detail-row {
            display: flex; justify-content: space-between;
            margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;
        }
        .detail-label { font-weight: bold; color: #555; }
        .detail-value { font-weight: bold; color: #000; font-size: 1.1em; }
        .result-highlight { color: var(--blue-bg); font-size: 1.3em; }

        /* ëŒì•„ê°€ê¸° í”Œë¡œíŒ… ë²„íŠ¼ */
        .fab-back {
            position: fixed; bottom: 30px; right: 30px;
            width: 50px; height: 50px; border-radius: 50%;
            background: #333; color: white;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            z-index: 900;
        }
    </style>
</head>
<body>

    <div id="main-screen">
        <div class="split-btn btn-left" onclick="showPage('list')">
            <i class="fas fa-book-open"></i>
            <div class="split-btn-content">
                <h1>ë°œí‘œ ì¡°íšŒ</h1>
            </div>
        </div>
        <div class="split-btn btn-right" onclick="showAuth()">
            <i class="fas fa-pen-nib"></i>
            <div class="split-btn-content">
                <h1>ë°œí‘œ ìƒì„±</h1>
            </div>
        </div>
    </div>

    <div id="auth-screen" class="pin-wrapper">
        <h2>ê´€ë¦¬ì ì¸ì¦</h2>
        <p>ë¹„ë°€ë²ˆí˜¸ 5ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš” (K0352)</p>
        <div class="pin-inputs" id="pin-container">
            <input type="password" maxlength="1" class="pin-box">
            <input type="password" maxlength="1" class="pin-box">
            <input type="password" maxlength="1" class="pin-box">
            <input type="password" maxlength="1" class="pin-box">
            <input type="password" maxlength="1" class="pin-box">
        </div>
        <button class="btn-action btn-secondary" onclick="goHome()">ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="list-screen" class="container">
        <h2 class="header-title">ë°œí‘œ ëª©ë¡</h2>
        
        <div class="search-bar">
            <select id="search-option">
                <option value="all">ì „ì²´ê¸°ê°„</option>
            </select>
            <input type="text" id="list-search-keyword" placeholder="ë°œí‘œ ì œëª© ì…ë ¥" style="flex: 1;">
            <button class="btn-search" onclick="renderUserList()">
                <i class="fas fa-search"></i> ê²€ìƒ‰
            </button>
        </div>

        <div style="margin-bottom: 10px; color: #666;">
            Total <strong style="color:red;" id="total-count">0</strong>ê±´
        </div>

        <table class="list-table">
            <thead>
                <tr>
                    <th style="width: 10%;">ë²ˆí˜¸</th>
                    <th style="width: 50%;">ë°œí‘œì œëª©</th>
                    <th style="width: 30%;">ë°œí‘œê¸°ê°„</th>
                    <th style="width: 10%;">ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody id="presentation-list-body">
                </tbody>
        </table>
    </div>

    <div id="query-screen" class="container">
        <h2 class="header-title" id="query-title">ë°œí‘œ ì œëª©</h2>
        <p style="text-align: center; color: #666;" id="query-period"></p>
        
        <div class="detail-card">
            <div id="dynamic-inputs">
                </div>
            <button class="btn-action" style="width:100%;" onclick="executeQuery()">ì¡°íšŒë²„íŠ¼</button>
        </div>
        
        <div id="query-result" class="detail-card" style="margin-top: 20px; display: none; background: #f0fdf4; border-color: #86efac;">
            </div>
    </div>

    <div id="admin-screen" class="container">
        <h2 class="header-title">ê´€ë¦¬ì ëª¨ë“œ</h2>
        
        <div style="background: #fff3cd; padding: 15px; border: 1px solid #ffeeba; border-radius: 5px; margin-bottom: 20px;">
            <strong>âš ï¸ GitHub Pages ì €ì¥ ì£¼ì˜ì‚¬í•­</strong><br>
            ì´ê³³ì—ì„œ ìƒì„±/ìˆ˜ì •ì„ ë§ˆì¹œ í›„ ë°˜ë“œì‹œ <b>[DB íŒŒì¼ ë‹¤ìš´ë¡œë“œ]</b>ë¥¼ í•˜ì—¬ 
            GitHub ì €ì¥ì†Œì˜ root í´ë”ì— <code>presentation.txt</code> íŒŒì¼ë¡œ ì—…ë¡œë“œ(Commit) í•´ì•¼ í•©ë‹ˆë‹¤.
        </div>

        <button class="btn-action" onclick="showCreateForm()">+ ìƒˆ ë°œí‘œ ë“±ë¡</button>
        <button class="btn-action btn-secondary" onclick="downloadDB()">ğŸ’¾ DB íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ì €ì¥ìš©)</button>
        
        <h3>ë“±ë¡ëœ ë°œí‘œ ëª©ë¡</h3>
        <ul id="admin-list" style="list-style: none; padding: 0;"></ul>
    </div>

    <div id="form-screen" class="container">
        <h2 class="header-title" id="form-header">ë°œí‘œ ìƒì„±</h2>
        <input type="hidden" id="edit-index">
        
        <div class="admin-form">
            <label>ë°œí‘œ ì œëª©</label>
            <input type="text" id="input-title">
            
            <label>ë°œí‘œ ê¸°ê°„</label>
            <div style="display: flex; gap: 10px;">
                <input type="datetime-local" id="input-start">
                <input type="datetime-local" id="input-end">
            </div>

            <label>ë°ì´í„° ì…ë ¥ (ì—‘ì…€ ì—…ë¡œë“œ ê°€ëŠ¥)</label>
            <div style="margin-bottom: 5px;">
                <input type="file" onchange="readExcel(this)" accept=".xlsx, .xls">
            </div>
            <textarea id="input-data" rows="10" placeholder="<ì´ë¦„> <ìƒë…„ì›”ì¼> <*ë°˜> <*ë²ˆí˜¸>&#13;&#10;í™ê¸¸ë™ 110305 8 21&#13;&#10;ê¹€ì§„ê²½ 120201 2 31"></textarea>
            
            <button class="btn-action" onclick="savePresentation()">ì €ì¥í•˜ê¸°</button>
            <button class="btn-action btn-secondary" onclick="showPage('admin')">ì·¨ì†Œ</button>
        </div>
    </div>

    <div class="fab-back" onclick="goHome()" title="ì²˜ìŒìœ¼ë¡œ">
        <i class="fas fa-home"></i>
    </div>

    <script>
        // --- ì„¤ì • ë° ìƒíƒœ ê´€ë¦¬ ---
        const DB_FILE = 'presentation.txt';
        const SECRET_KEY = 'K0352_SECRET'; // ê°„ë‹¨í•œ ì•”í˜¸í™” í‚¤
        let presentations = []; // ë©”ëª¨ë¦¬ ìƒ ë°ì´í„°
        let currentPresIdx = null;

        // ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ (K0352 -> SHA256)
        const ADMIN_HASH = "80f4139f4e2f8914b437292275b287532336338006e0013897b5e406f850e04d";

        // --- ì´ˆê¸°í™” ---
        window.onload = async function() {
            await loadDatabase();
            setupPin();
            
            // ëŒì•„ê°€ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸° (ë©”ì¸ì—ì„œë§Œ)
            document.querySelector('.fab-back').style.display = 'none';
        };

        function goHome() {
            hideAll();
            document.getElementById('main-screen').style.display = 'flex';
            document.querySelector('.fab-back').style.display = 'none';
            resetPin();
        }

        function showPage(pageName) {
            hideAll();
            document.querySelector('.fab-back').style.display = 'flex';
            
            if (pageName === 'list') {
                document.getElementById('list-screen').classList.add('active');
                renderUserList();
            } else if (pageName === 'admin') {
                document.getElementById('admin-screen').classList.add('active');
                renderAdminList();
            }
        }

        function hideAll() {
            const screens = ['main-screen', 'auth-screen', 'list-screen', 'query-screen', 'admin-screen', 'form-screen'];
            screens.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.style.display = 'none';
                    el.classList.remove('active');
                }
            });
        }

        // --- ë°ì´í„°ë² ì´ìŠ¤ (DB) ë¡œì§ ---
        
        // 1. GitHub Pagesì—ì„œ íŒŒì¼ ì½ê¸°
        async function loadDatabase() {
            try {
                // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•´ timestamp ì¶”ê°€
                const response = await fetch(DB_FILE + '?v=' + new Date().getTime());
                if (!response.ok) throw new Error("DB file not found");
                const encryptedText = await response.text();
                
                // ë³µí˜¸í™”
                const bytes = CryptoJS.AES.decrypt(encryptedText, SECRET_KEY);
                const decryptedData = bytes.toString(CryptoJS.enc.Utf8);
                
                if (decryptedData) {
                    presentations = JSON.parse(decryptedData);
                }
            } catch (e) {
                console.log("ì´ˆê¸° DB ì—†ìŒ í˜¹ì€ ë¡œë“œ ì‹¤íŒ¨ (ì²« ì‹¤í–‰ ì‹œ ì •ìƒ):", e);
                presentations = [];
            }
        }

        // 2. ê´€ë¦¬ììš© DB íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        function downloadDB() {
            // ì•”í˜¸í™”
            const encrypted = CryptoJS.AES.encrypt(JSON.stringify(presentations), SECRET_KEY).toString();
            
            const blob = new Blob([encrypted], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = DB_FILE;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('presentation.txt íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\nGitHub ì €ì¥ì†Œì— ì´ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.');
        }

        // --- ê´€ë¦¬ì ì¸ì¦ (PIN) ---
        function showAuth() {
            hideAll();
            document.querySelector('.fab-back').style.display = 'flex';
            document.getElementById('auth-screen').style.display = 'flex'; // flexë¡œ ì¤‘ì•™ì •ë ¬
            document.querySelectorAll('.pin-box')[0].focus();
        }

        function setupPin() {
            const inputs = document.querySelectorAll('.pin-box');
            inputs.forEach((input, index) => {
                input.addEventListener('keyup', async (e) => {
                    if(e.key === 'Backspace' && index > 0 && input.value === '') {
                        inputs[index-1].focus();
                    } else if (input.value.length === 1 && index < inputs.length - 1) {
                        inputs[index+1].focus();
                    }
                    
                    const code = Array.from(inputs).map(i => i.value).join('');
                    if (code.length === 5) {
                        // í•´ì‹œ í™•ì¸
                        const msgBuffer = new TextEncoder().encode(code);
                        const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                        const hashArray = Array.from(new Uint8Array(hashBuffer));
                        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

                        if (hashHex === ADMIN_HASH) {
                            showPage('admin');
                        } else {
                            alert('ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜');
                            resetPin();
                        }
                    }
                });
            });
        }

        function resetPin() {
            document.querySelectorAll('.pin-box').forEach(i => i.value = '');
        }

        // --- ê´€ë¦¬ì ê¸°ëŠ¥ (CRUD) ---
        function renderAdminList() {
            const list = document.getElementById('admin-list');
            list.innerHTML = '';
            presentations.forEach((p, idx) => {
                const li = document.createElement('li');
                li.style.cssText = "padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;";
                li.innerHTML = `
                    <span>[${idx+1}] <strong>${p.title}</strong> (${p.start} ~ ${p.end})</span>
                    <div>
                        <button class="btn-action btn-secondary" style="margin:0; font-size:0.8rem;" onclick="showCreateForm(${idx})">ìˆ˜ì •</button>
                        <button class="btn-action btn-danger" style="margin:0; font-size:0.8rem;" onclick="deletePres(${idx})">ì‚­ì œ</button>
                    </div>
                `;
                list.appendChild(li);
            });
        }

        function showCreateForm(index = null) {
            hideAll();
            document.getElementById('form-screen').classList.add('active');
            
            const titleEl = document.getElementById('input-title');
            const startEl = document.getElementById('input-start');
            const endEl = document.getElementById('input-end');
            const dataEl = document.getElementById('input-data');
            const headerEl = document.getElementById('form-header');
            const idxEl = document.getElementById('edit-index');

            if (index !== null) {
                const p = presentations[index];
                headerEl.innerText = "ë°œí‘œ ìˆ˜ì •";
                idxEl.value = index;
                titleEl.value = p.title;
                startEl.value = p.start;
                endEl.value = p.end;
                
                // ë°ì´í„° ë°°ì—´ -> í…ìŠ¤íŠ¸ ë³µì›
                let raw = p.headers.join(' ') + '\n';
                p.data.forEach(row => raw += row.join(' ') + '\n');
                dataEl.value = raw;
            } else {
                headerEl.innerText = "ìƒˆ ë°œí‘œ ìƒì„±";
                idxEl.value = "";
                titleEl.value = "";
                startEl.value = "";
                endEl.value = "";
                dataEl.value = "";
            }
        }

        // ì—‘ì…€ íŒŒì¼ ì½ê¸°
        function readExcel(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                
                // í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (ê³µë°± êµ¬ë¶„)
                const txt = XLSX.utils.sheet_to_csv(sheet, {FS: " "});
                document.getElementById('input-data').value = txt;
            };
            reader.readAsArrayBuffer(file);
        }

        function savePresentation() {
            const idxVal = document.getElementById('edit-index').value;
            const title = document.getElementById('input-title').value;
            const start = document.getElementById('input-start').value;
            const end = document.getElementById('input-end').value;
            const rawData = document.getElementById('input-data').value;

            if(!title || !start || !rawData) return alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.');

            // ë°ì´í„° íŒŒì‹±
            const lines = rawData.trim().split('\n');
            let headers = lines[0].trim().split(/\s+/).map(h => h.replace(/[<>]/g, ''));
            const data = [];
            for(let i=1; i<lines.length; i++) {
                if(!lines[i].trim()) continue;
                data.push(lines[i].trim().split(/\s+/));
            }

            const newObj = { title, start, end, headers, data };

            if(idxVal === "") {
                presentations.push(newObj);
            } else {
                presentations[parseInt(idxVal)] = newObj;
            }

            showPage('admin');
        }

        function deletePres(idx) {
            if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                presentations.splice(idx, 1);
                renderAdminList();
            }
        }

        // --- ì‚¬ìš©ì ê¸°ëŠ¥ (ì¡°íšŒ) ---
        function renderUserList() {
            const tbody = document.getElementById('presentation-list-body');
            const keyword = document.getElementById('list-search-keyword').value.toLowerCase();
            tbody.innerHTML = '';

            let count = 0;
            const now = new Date();

            presentations.forEach((p, idx) => {
                if (keyword && !p.title.toLowerCase().includes(keyword)) return;

                count++;
                const tr = document.createElement('tr');
                
                // ê¸°ê°„ ì²´í¬
                const startDate = new Date(p.start);
                const endDate = new Date(p.end);
                let btnText = "ì¡°íšŒ";
                let btnClass = "btn-action";
                let clickAction = `onclick="openQuery(${idx})"`;

                if (now < startDate) {
                    btnText = "ëŒ€ê¸°ì¤‘";
                    btnClass = "btn-secondary";
                    clickAction = `onclick="alert('ì•„ì§ ë°œí‘œ ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤.')"`;
                }

                tr.innerHTML = `
                    <td>${idx + 1}</td>
                    <td style="text-align:left; font-weight:bold;">${p.title}</td>
                    <td>${p.start.replace('T', ' ')} ~ ${p.end.replace('T', ' ')}</td>
                    <td><button class="${btnClass}" style="margin:0; padding:5px 10px;" ${clickAction}>${btnText}</button></td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById('total-count').innerText = count;
            if(count === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-row">ì¡°íšŒ ê°€ëŠ¥í•œ ë°œí‘œê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        }

        function openQuery(idx) {
            currentPresIdx = idx;
            const p = presentations[idx];
            hideAll();
            document.getElementById('query-screen').classList.add('active');
            document.querySelector('.fab-back').style.display = 'flex';

            document.getElementById('query-title').innerText = p.title;
            document.getElementById('query-period').innerText = `[${p.start.replace('T',' ')} ~ ${p.end.replace('T',' ')}]`;
            document.getElementById('query-result').style.display = 'none';

            const inputsDiv = document.getElementById('dynamic-inputs');
            inputsDiv.innerHTML = '';

            p.headers.forEach(h => {
                if(!h.startsWith('*')) {
                    inputsDiv.innerHTML += `
                        <div style="margin-bottom:10px;">
                            <label style="display:block; margin-bottom:5px;">${h}</label>
                            <input type="text" class="query-input" data-key="${h}" placeholder="${h} ì…ë ¥" style="width:100%; padding:10px;">
                        </div>
                    `;
                }
            });
        }

        function executeQuery() {
            const p = presentations[currentPresIdx];
            const inputs = document.querySelectorAll('.query-input');
            const userInputs = {};
            
            // ì…ë ¥ê°’ ìˆ˜ì§‘
            inputs.forEach(input => {
                userInputs[input.dataset.key] = input.value.trim();
            });

            // ë°ì´í„° ê²€ìƒ‰
            const idHeaders = p.headers.map((h, i) => ({name: h, index: i})).filter(obj => !obj.name.startsWith('*'));
            
            const foundRow = p.data.find(row => {
                return idHeaders.every(h => row[h.index] === userInputs[h.name]);
            });

            const resultDiv = document.getElementById('query-result');
            resultDiv.style.display = 'block';

            if(foundRow) {
                let html = '<h3 style="text-align:center; color:#28a745;">ì¡°íšŒê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h3><hr>';
                p.headers.forEach((h, i) => {
                    if(h.startsWith('*')) {
                        const cleanName = h.substring(1);
                        html += `
                            <div class="detail-row">
                                <span class="detail-label">${cleanName}</span>
                                <span class="detail-value result-highlight">${foundRow[i]}</span>
                            </div>
                        `;
                    }
                });
                resultDiv.innerHTML = html;
            } else {
                resultDiv.innerHTML = '<h3 style="text-align:center; color:#dc3545;">ë°œí‘œ ëª©ë¡ì— ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</h3><p style="text-align:center;">ì…ë ¥ ì •ë³´ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
                resultDiv.style.backgroundColor = '#fff5f5';
                resultDiv.style.borderColor = '#feb2b2';
            }
        }
    </script>
</body>
</html>
